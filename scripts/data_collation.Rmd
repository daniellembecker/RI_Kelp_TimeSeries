---
title: "data_collation"
author: "daniellembecker"
date: "2024-03-21"
output: html_document
---

# Use this script to clean and merge unique data types (e.g., swath, fish, UPC) from multiple years

# Load libraries 
```{r}
library(plyr)
library(dplyr)
library(tidyverse)
library(lubridate)
```


# Load all data files from multiple years and seperate them into specific categories: UPC, swath, Morph, Site, QUAD, kelp, fish, and COVER
```{r}

# Set your directory path
directory <- "data/kelp_timeseries_data/"

# List files in the directory
files <- list.files(directory)

# Initialize an empty list to store data frames
data_frames <- list()

# Loop through each file
for (file in files) {
    # Read the file into a data frame
    # Adjust the read function according to your file type (e.g., read.csv, read.table)
    # Specify other parameters as needed (e.g., header = TRUE)
    file_path <- file.path(directory, file)
    df_name <- gsub("\\..*", "", file)  # Extract file name without extension
    assign(df_name, read.csv(file_path, stringsAsFactors = FALSE))
}

# Now, each file is a separate data frame with its own variable name


```

# Combine kelp dataframes
```{r}
# Kelp data is cleaned and ready

# use rbind.fill() method in R to combine data frames with different columns
kelp_data <- rbind.fill(kelp, FtWeatherill_kelp_2016)

#delete repetative data collector columns
kelp_data <- kelp_data[ -c(11:17) ]

# Use lubridate to format date to be consistent
kelp_data$DATE <- mdy(kelp_data$DATE)

# Rename King's Beach to Kings Beach
kelp_data$SITE[kelp_data$SITE == "King's Beach"] <- "Kings Beach"

# output updated dataframe
write.csv(kelp_data, "output/cleaned_data/kelp.data.clean.csv", row.names = FALSE)
```

# Combine Kelp_Morph dataframes
```{r}

# Morph data is cleaned and ready

# use rbind.fill() method in R to combine data frames with different columns
morph_data <- rbind.fill(Subsurface_Kelp_Morph_2017, Subsurface_Kelp_Morph_2018)

# remove columns with observer and unneeded data
morph_data <- morph_data[ -c(11:14) ]

# Make all columns capitalized
colnames(morph_data) <- toupper(colnames(morph_data))

# Use lubridate to format date to be consistent
morph_data$DATE <- mdy(morph_data$DATE)

# output updated dataframe
write.csv(morph_data, "output/cleaned_data/morph.data.clean.csv", row.names = FALSE)
```

# Combine fish dataframes
```{r}

# Fish data is cleaned and ready

# use rbind.fill() method in R to combine data frames with different columns
fish_data <- rbind.fill(FtWeatherill_fish_2016, FtWeatherill_fish_2017, fish_2018_Hump_Lab_size_classes)

# remove columns with observer and unneeded data
fish_data <- fish_data[ -c(10:14) ]

# Use the actual size data to bin into the size classes to combine with other dataframe
fish$SIZE <- cut(fish$actual_size, breaks = c(0, 10, 20, 30, 40, 50, 70, 100, Inf),
               labels = c("< 10", "10_20", "20_30", "30_40", "40_50", "50_70", "70_100", "> 100"),include.lowest = TRUE, right = FALSE)

# combine updated dataframes
fish_data <- left_join(fish, fish_data)

# remove columns with VIS
fish_data <- fish_data[ -c(14) ]

# Use lubridate to format date to be consistent
fish_data$DATE <- mdy(fish_data$DATE)

# output updated dataframe
write.csv(fish_data, "output/cleaned_data/fish.data.clean.csv", row.names = FALSE)

# look at fish_Aggregated later - Austin, this is kelp density possibly?

```

# Combine UPC dataframes
```{r}

# use rbind.fill() method in R to combine data frames with different columns
UPC_data <- rbind.fill(UPC, UPC_2017, UPC_2018, FtWeatherill_UPC_2016, FtWeatherill_UPC_2016_CT)

# Rename ft. wetherill to fort wetherill
UPC_data$SITE[UPC_data$SITE == "Ft. Weatherill"] <- "Fort Wetherill"

# remove columns with observer and unneeded data
UPC_data <- UPC_data[ -c(21:24) ]
```

# Combine swath dataframes
```{r}

# use rbind.fill() method in R to combine data frames with different columns
swath_data <- rbind.fill(swath, swath_2018, swath_count, FtWeatherill_swath_2016)

# Rename ft. wetherill to fort wetherill
swath_data$SITE[swath_data$SITE == "Ft.Weatherill"] <- "Fort Wetherill"

# the one swath data.frame has 115 variables because each species is listed instead of its code, fo you want me to replace with the code and make it wide to long format?

```

# Combine site.info dataframes
```{r}

# use rbind.fill() method in R to combine data frames with different columns
site.info.dat <- rbind.fill(Site_info_2017, Site_info_2018, Site_info_template_v1)

```

# Combine QUAD dataframes
```{r}

# To do: species codes transform

# use rbind.fill() method in R to combine data frames with different columns
QUAD_data <- rbind.fill(QUAD, QUAD_2018, FtWeatherill_QUAD_2017, FtWeatherill_QUAD_2016_TALBENHORIN)

# Rename ft. wetherill to fort wetherill
QUAD_data$SITE[QUAD_data$SITE == "Ft Wetherill"] <- "Fort Wetherill"


```








